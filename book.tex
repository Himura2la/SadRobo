%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% SadRobo Comicbook
% Version 0.1 (08/05/16)
%
% This template has been downloaded from:
% https://github.com/Himura2la/SadRobo
%
% Original author:
% SadBobo Team
%
% License:
% SadRobo License (А если серьёзно, какая у нас лицензия?)
% 			     (Кто разбирается в лицензиях? Я~--- нет.)
%           (И кажется у гитхаба есть ограничения с этим.)
%
% Важные замечания:
% Роботу всё ещё грустно.
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\documentclass[17pt,oneside]{memoir} % 14, 17, 20

%-------------------------------------------------------------------------
%            	Подключаемые пакеты
%-------------------------------------------------------------------------
\usepackage{cmap} % Для кодировки PDF
\usepackage[utf8]{inputenc} % Кодировка входа
\usepackage[encoding,filenameencoding=utf8]{grffile} %Нормально читаем кодировку файловой системы
\usepackage[T2A]{fontenc} % Кодировка выхода
\usepackage[russian]{babel} % Локаль
\usepackage{pscyr} % Крутые русские шрифты (http://scon155.phys.msu.su/~swan/cyrtug2000.pdf)
\usepackage[babel=true]{microtype} % Точный подгон текста
\usepackage{graphicx} % Картинки
\usepackage[unicode=true,bookmarks=true,bookmarksnumbered=false,bookmarksopen=false,breaklinks=false,pdfborder={0 0 1},backref=section,colorlinks=false]{hyperref} % Мета-информация для pdf


%-------------------------------------------------------------------------
%           	Костыль для кириллицы в input
%-------------------------------------------------------------------------
\makeatletter  
    \let\old@input\input
    \renewcommand\input[1]{
        \expandafter\old@input{"\detokenize{#1}"}
    }
\makeatother


%----------------------------------------------------------------------
%               	Пути к файлам
%----------------------------------------------------------------------
\makeatletter
	\def\input@path{{texts/}}           % К текстовым файлам (для input)
\makeatother

\graphicspath{{pictures/}}              % К картинкам
\DeclareGraphicsExtensions{.png,.jpg}   % Расширения для используемых картинок


%----------------------------------------------------------------------------------------
%		Страницы, отступы, размеры шапки и потолка
%----------------------------------------------------------------------------------------
\setstocksize{210mm}{210mm} % Размер страницы, взял квадрат на данный момент
\settrimmedsize{\stockheight}{\stockwidth}{*} % No trims !!! Хз как работает
\setlrmarginsandblock{2cm}{2cm}{*} % Отступ слева/спава (margins)
\setulmarginsandblock{1cm}{2cm}{*} % Отступ сверху/снизу
\setheadfoot{0cm}{8pt} % Высота шапки и подвала
\setheaderspaces{*}{0cm}{*} %Пространство между шапкой и блоком текста


%----------------------------------------------------------------------------------------
%		Шапка и подвал
%----------------------------------------------------------------------------------------
\makepagestyle{RoboPage} % Новый стиль страницы
\setlength{\headwidth}{\textwidth} % Ширина шапки, как и у текста
\makeheadrule{RoboPage}{\textwidth}{0mm} % Header rule NO
\makeoddhead{RoboPage}{}{}{} % Спецификация шапки
\makeoddfoot{RoboPage}{}{\scriptsize {\thepage \quad \vrule \quad \thelastpage}}{} % Спецификация подвала
\makeoddfoot{plain}{}{\footnotesize {\thepage \quad \vrule \quad \thelastpage}}{} %Нумерация страниц
\pagestyle{RoboPage} % Используем созданный нами стиль


%----------------------------------------------------------------------------------------
%		Формат глав
%----------------------------------------------------------------------------------------

\makechapterstyle{RoboChapter}{ % Определяем новый стиль
\renewcommand{\chapterheadstart}{} % Пробел перед началом главы
\renewcommand{\printchaptername}{} % Спецификация слова "Глава"
\renewcommand{\printchapternum}{} % Спецификация номера главы
\renewcommand{\afterchapternum}{} % Пробел между номером главы и текстом
\renewcommand{\printchaptertitle}[1]{ % Спецификация названия главы
\centering \Huge{##1}}
\renewcommand{\afterchaptertitle}{
\vskip2.5\onelineskip        %Отступ после названия главы
}}
\chapterstyle{RoboChapter} % Используем новый стиль


%----------------------------------------------------------------------------------------
%		Разное и спецификации документа
%----------------------------------------------------------------------------------------
\setlength{\parindent}{0pt} % No paragraph indentation!

\midsloppy % Перенос строк, что-то между \fussy и \sloppy

\checkandfixthelayout % Tell memoir to implement the above

\renewcommand{\familydefault}{far} % Шрифт (tex\latex\pscyr\pscyr.sty)   % Подключаем чудо-шрифты из pscyr

\newcommand\X{\par\noindent---~}  % Макрос для форматирования диалогов

\newenvironment{dialog}
{  }
{  }

\newenvironment{monolog}
{ \begin{quote}\itshape }
{ \end{quote} }

%-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------
%		Считаем оптимальную ширину картинки
%-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------
\makeatletter 
\def \maxwidth{
	\ifdim\Gin@nat@width>\linewidth
		\linewidth
	\else
		\Gin@nat@width
	\fi}
\makeatother


%-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------
%		Макрос для диалога, первый параметр имя файлов (можно на 2 разделить, если очень хочется), второй - описание картинки
%-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------

\newcommand{\newdialog}[2]{
	\chapter{Робот, которому грустно, и #1}
	\input{#1}
	\begin{figure}[p]
		\center{\includegraphics[height = 16cm, width = \maxwidth, keepaspectratio]{#1}}
		\center{#2}
		\label{fig:image}
	\end{figure}
}


%-------------------------------------------------------------------------------------------------------------------
%              	Тело документа
%-------------------------------------------------------------------------------------------------------------------

\begin{document} %-----------------------------------------------------

\newdialog{Викинги}{Борода лучше своего отсутствия}
\newdialog{Создатель}{Все мы что-то создаём}
\newdialog{Паук}{Тащемта, например}
\newdialog{Ницше}{Сверхчеловек не нашего времени}

\end{document}