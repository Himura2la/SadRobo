%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% SadRobo Comicbook
% Version 0.1 (08/05/16)
%
% This template has been downloaded from:
% https://github.com/Himura2la/SadRobo
%
% Original author:
% SadBobo Team
%
% License:
% SadRobo License (А если серьёзно, какая у нас лицензия?)
% 			     (Кто разбирается в лицензиях? Я~--- нет.)
%           (И кажется у гитхаба есть ограничения с этим.)
%
% Важные замечания:
% Роботу всё ещё грустно.
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\documentclass[17pt]{memoir} % 14, 17, 20
\input{config.tex} % Загружаем файл с настройками


% ------- Костыль для кириллицы в input -------

\makeatletter  
    \let\old@input\input
    \renewcommand\input[1]{
        \expandafter\old@input{"\detokenize{#1}"}
    }
\makeatother


% ------- Считаем оптимальную ширину картинки  -------
% ------- По какой-то причине Gin@nat@width возвращает не то (на Создателе), что нужно. разобраться.

\makeatletter 
\def \maxwidth{
	\ifdim\Gin@nat@width>\linewidth
		\linewidth
	\else
		\Gin@nat@width
	\fi}
\makeatother


% ------- Робо-макросы ------- 

\newcommand\R{\par\noindent---~}  % Маркер робота
\newcommand\X{\par\noindent---~}  % Маркер собеседника

\newenvironment{dialog} % Пространство диалога
{  } % Выполняется в начале
{  } % Выполняется в конце

\newenvironment{monolog} % Пространство размышлений
{ \begin{quote}\itshape } % Выполняется в начале
{ \end{quote} } % Выполняется в конце

\newcommand{\newdialog}[4]{
	\chapter{Робот, которому грустно, и #2}
		\input{#2}
		\begin{figure}[p!]
			\centering
			\includegraphics[height = 190mm, width = \linewidth, keepaspectratio]{#2}    %170 для того, чтобы вместилась надпись
			\ifthenelse{#4 = 1}{\center #3}{}
		\end{figure}
	\setcounter{dianum}{#1}
}



\begin{document} % --------------------------------

\newdialog{002}{Викинги}{Борода лучше своего отсутствия}{0} %0 - вертикальная, 1 - горизонтальная.
\newdialog{004}{Создатель}{Все мы что-то создаём}{1}
\newdialog{014}{Паук}{Тащемта, например}{1}
\newdialog{018}{Ницше}{Сверхчеловек не нашего времени}{1}
\newdialog{029}{Все}{Это можно было бы назвать вечеринкой, если Вечер бы пришёл. Но пришёл только Все}{1}
\newdialog{035}{Студенты}{Фанатичные адепты богини Халявы}{1}

\end{document}