%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% SadRobo Comicbook
% Version 0.1 (08/05/16)
%
% This template has been downloaded from:
% https://github.com/Himura2la/SadRobo
%
% Original author:
% SadBobo Team
%
% License:
% SadRobo License (А если серьёзно, какая у нас лицензия?)
% 			     (Кто разбирается в лицензиях? Я~--- нет.)
%           (И кажется у гитхаба есть ограничения с этим.)
%
% Важные замечания:
% Роботу всё ещё грустно.
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\documentclass[17pt]{memoir} % 14, 17, 20

\usepackage{cmap} % Для кодировки PDF
\usepackage[utf8]{inputenc} % Кодировка входа
\usepackage[encoding,filenameencoding=utf8]{grffile} %Нормально читаем кодировку файловой системы
\usepackage[T2A]{fontenc} % Кодировка выхода
\usepackage[russian]{babel} % Локаль
\usepackage{pscyr} % Крутые русские шрифты (http://scon155.phys.msu.su/~swan/cyrtug2000.pdf)
\usepackage[babel=true]{microtype} % Точный подгон текста
\usepackage{graphicx} % Картинки
\usepackage[unicode=true,bookmarks=true,bookmarksnumbered=false,bookmarksopen=false,breaklinks=false,pdfborder={0 0 1},backref=section,colorlinks=false]{hyperref} % Мета-информация для pdf


% Костыль для кириллицы в input
\makeatletter  
    \let\old@input\input
    \renewcommand\input[1]{
        \expandafter\old@input{"\detokenize{#1}"}
    }
\makeatother


% Пути к файлам
\makeatletter
	\def\input@path{{texts/}}           % К текстовым файлам (для input)
\makeatother

\graphicspath{{pictures/}}              % К картинкам
\DeclareGraphicsExtensions{.png,.jpg}   % Расширения для используемых картинок


% ------- Геометрия -------

\setstocksize{210mm}{210mm} % Размер исходников
\settrimmedsize{200mm}{195mm}{*} % Размер обрезанной страницы 
\settrims{5mm}{10mm} 			 % Размер обреза сверху/изнутри
\setlrmarginsandblock{5mm}{5mm}{*} % Отступ слева/справа
\setulmarginsandblock{5mm}{10mm}{*} % Отступ сверху/снизу
\setheadfoot{0pt}{1.5em} % Высота шапки и подвала
\setheaderspaces{*}{0pt}{*} %Пространство между шапкой и блоком текста
\setmarginnotes{0pt}{0pt}{0pt} % Ликвидация области заметок

\usepackage{showframe} % Любые манипуляции с полями проводить с этим пакетом

% ------- Колонтитулы -------

\setlength{\headwidth}{\textwidth} % Ширина шапки, как и у текста
\makeheadrule{plain}{0pt}{0pt} % No header line

\makeoddhead{plain}{
	%\scriptsize{\theauthor\hskip.2cm\vrule\hskip.2cm\itshape{\thetitle}}
}{}{} % Спецификация нечетной шапки (текст)
\makeevenhead{plain}{
	%\scriptsize{\theauthor\hskip.2cm\vrule\hskip.2cm\itshape{\thetitle}}
}{}{} % Спецификация четной шапки (пикча)

\makeoddfoot{plain}{}{
	{\scriptsize \thepage \quad \vrule \quad \thelastpage}
}{} % Спецификация нечетного подвала (текст)
\makeevenfoot{plain}{}{
	{\scriptsize \thepage \quad \vrule \quad \thelastpage}
}{} % Спецификация четного подвала (пикча)
\pagestyle{plain}





% Переписываем оформление названия главы
\makeatletter
	\renewcommand{\@makechapterhead}[1]{
		%\vspace*{20 pt}  %Отступ перед названием (регулируется общими отступами)
		{\centering\normalfont\bfseries
			\huge 	  %Размер шрифта (huge)
			%\setlength{\parindent}{0pt} % и так ноль
			
			%\ifnum \value{secnumdepth}>1 
	  		% \if@mainmatter\thechapter.\ \fi % а нафига?
			%\fi
			
			#1 %\par\nobreak
			\vspace{20 pt} % Отступ после названия
		}
	}	
\makeatother


%----------------------------------------------------------------------------------------
%		Разное и спецификации документа
%----------------------------------------------------------------------------------------
\setlength{\parindent}{0pt} % No paragraph indentation!

\midsloppy % Перенос строк, что-то между \fussy и \sloppy

\checkandfixthelayout % just do it, memoir

\renewcommand{\familydefault}{far} % Шрифт (tex\latex\pscyr\pscyr.sty)   % Подключаем чудо-шрифты из pscyr

\newcommand\R{\par\noindent---~}  % Маркер робота
\newcommand\X{\par\noindent---~}  % Маркер собеседника

\newenvironment{dialog} % Пространство диалога
{  } % Выполняется в начале
{  } % Выполняется в конце

\newenvironment{monolog} % Пространство размышлений
{ \begin{quote}\itshape } % Выполняется в начале
{ \end{quote} } % Выполняется в конце

%-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------
%		Считаем оптимальную ширину картинки
%-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------
\makeatletter 
\def \maxwidth{
	\ifdim\Gin@nat@width>\linewidth
		\linewidth
	\else
		\Gin@nat@width
	\fi}
\makeatother

%-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------
%		Макрос для диалога, первый параметр имя файлов (можно на 2 разделить, если очень хочется), второй - описание картинки
%-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------

\newcommand{\newdialog}[2]{
	\chapter{Робот, которому грустно, и #1}
	\input{#1}
	\begin{figure}[p!]
		\center{\includegraphics[height = 18cm, width = \maxwidth, keepaspectratio]{#1}}
		\center{#2}
		%\label{pic:#1}
	\end{figure}
}


%-------------------------------------------------------------------------------------------------------------------
%              	Тело документа
%-------------------------------------------------------------------------------------------------------------------

\begin{document} %-----------------------------------------------------


\newdialog{Викинги}{Борода лучше своего отсутствия}
\newdialog{Создатель}{Все мы что-то создаём}
\newdialog{Паук}{Тащемта, например}
\newdialog{Ницше}{Сверхчеловек не нашего времени}

\end{document}