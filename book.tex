%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% SadRobo Comicbook
% Version 0.1 (08/05/16)
%
% This template has been downloaded from:
% https://github.com/Himura2la/SadRobo
%
% Original author:
% SadBobo Team
%
% License:
% SadRobo License (А если серьёзно, какая у нас лицензия?)
% 			     (Кто разбирается в лицензиях? Я~--- нет.)
%           (И кажется у гитхаба есть ограничения с этим.)
%
% Важные замечания:
% Роботу всё ещё грустно.
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\documentclass[17pt]{memoir} % 14, 17, 20
\input{config.tex} % Загружаем файл с настройками


% ------- Костыль для кириллицы в input -------

\makeatletter  
    \let\old@input\input
    \renewcommand\input[1]{
        \expandafter\old@input{"\detokenize{#1}"}
    }
\makeatother


% ------- Считаем оптимальную ширину картинки  -------
% ------- Чтобы макрос работал как нужно, не должны быть указаны резолюшны. Долой жепеге!

\makeatletter 
\def \maxwidth{
	\ifdim\Gin@nat@width>159.5mm
		159.5mm
	\else
		\Gin@nat@width
	\fi}
\makeatother

% ------- Служебные переменные для длины и ширины картинки ------- 
\newlength\imageheight
\newlength\imagewidth
\newcounter{vert}


% ------- Робо-макросы ------- 

\newcommand\R{\par\noindent---~}  % Маркер робота
\newcommand\X{\par\noindent---~}  % Маркер собеседника

\newenvironment{dialog} % Пространство диалога
{  } % Выполняется в начале
{  } % Выполняется в конце

\newenvironment{monolog} % Пространство размышлений
{ \begin{quote}\itshape } % Выполняется в начале
{ \end{quote} } % Выполняется в конце

\newcommand{\newdialog}[3]{
	\chapter{Робот, которому грустно, и #2}
		\input{#2}
		%\begin{floatingfigure}[r]{159.5mm} 
		\begin{figure}
			\settoheight\imageheight{\includegraphics{#2}}
			\settowidth\imagewidth{\includegraphics{#2}}
			\ifthenelse{\imagewidth > \imageheight}{\setcounter{vert}{0}}{\setcounter{vert}{1}}
			
			
			\ifthenelse{\value{vert} = 1}{\raggedleft}{\centering}
					
			\fbox{   %Эта фигня до теста, если её убрать, то картинка будет размером как рамка
			\includegraphics[height = 181.5mm, width = \maxwidth, keepaspectratio]{#2}    %Прописал числами, а то что-расходятся все параметры
			
			}
			
			\ifthenelse{\value{vert} = 1}{}{\centering #3}
			%\ifthenelse{\value{vert} = 1}{\raggedright \begin{sideways} \raggedleft#3 \end{sideways}}{}
		\end{figure}
		%\end{floatingfigure}
	\setcounter{dianum}{#1}
}



\begin{document} % --------------------------------

\newdialog{002}{Викинги}{Борода лучше своего отсутствия}
\newdialog{004}{Создатель}{Все мы что-то создаём}
\newdialog{014}{Паук}{Тащемта, например}
\newdialog{018}{Ницше}{Сверхчеловек не нашего времени}
\newdialog{029}{Все}{Это можно было бы назвать вечеринкой, если Вечер бы пришёл. Но пришёл только Все}
\newdialog{035}{Студенты}{Фанатичные адепты богини Халявы}
\newdialog{036}{Митинг}{Листовки, шарики и атрибутика в подарок!}
\newdialog{040}{Мой здравый смысл}{Вернись ко мне, когда наступит вчера}
\newdialog{061}{Утренняя газета}{Все-равно её никто не читает}
\newdialog{071}{Лао Цзы}{Восточная философия - сложна и опасна}
\newdialog{072}{Время}{Его всегда слишком много, но никогда не хватает}
\newdialog{074}{Даос-какаос}{Ох это прекрасное, освежающее и бодрящее столкновение с посохом}
\newdialog{088}{Мотивация}{Тут что-то нужно ещё добавить?}
\newdialog{089}{Политика}{Нельзя коснуться, не испачкавшись}
\newdialog{090}{Маркетинг}{Без него не было бы этой книги}
\newdialog{095}{Баян}{Где-то я всё это уже видел}
\newdialog{118}{Калечные девы}{Датфил}
\newdialog{119}{Лекция}{Я там был, инфа 100\%}
\newdialog{144}{Шайа Лабаф}{Джазовый дуэт}
\newdialog{147}{Шон Бин}{Казалось бы, причём здесь Караваждо?}
\newdialog{150}{Аниме}{Примерно так я и стал хиккой}
\newdialog{158}{Председатель земного шара}{Когда умирают травы — сохнут}

\newdialog{12}{Живая изгородь}{Цыферь и зело не есть истина }
\newdialog{17}{Бомжи-опенсорсники}{Цыферь и зело не есть истина }
\newdialog{23}{Бездна}{Цыферь и зело не есть истина }
\newdialog{30}{Ректор}{Цыферь и зело не есть истина }
\newdialog{46}{Буддийский монах}{Цыферь и зело не есть истина }
\newdialog{47}{Онотоле}{Цыферь и зело не есть истина }
\newdialog{48}{Всеведущий}{Цыферь и зело не есть истина }
\newdialog{49}{Монголы}{Цыферь и зело не есть истина }
\newdialog{76}{Солипсическая бочка}{Цыферь и зело не есть истина }
\newdialog{77}{Мэттью Макконахи}{Цыферь и зело не есть истина }
\newdialog{103}{Смысл жизни}{Цыферь и зело не есть истина }
\newdialog{92}{Город}{Цыферь и зело не есть истина }
\newdialog{93}{Философия}{Цыферь и зело не есть истина }
\newdialog{100}{Зло}{Цыферь и зело не есть истина }
\newdialog{101}{Добро}{Цыферь и зело не есть истина }
\newdialog{102}{Абсолютное зло}{Цыферь и зело не есть истина }
\newdialog{103}{Абсолютное добро}{Цыферь и зело не есть истина }
\newdialog{104}{Справедливость}{Цыферь и зело не есть истина }
\newdialog{96}{Актуальность моей работы}{Цыферь и зело не есть истина }
\newdialog{106}{Лоли}{Цыферь и зело не есть истина }
\newdialog{108}{Эльпедо Медведо}{Цыферь и зело не есть истина }
\newdialog{160}{Уныние}{Цыферь и зело не есть истина }


\end{document}